set names 'utf8';

create table "order" ("uuid" uuid not null default gen_random_uuid(), "customer_name" varchar(255) null, "customer_email" varchar(255) not null, "status" text check ("status" in ('PENDING', 'CONFIRMED', 'CANCELLED', 'FULFILLED')) not null default 'PENDING', "created_at" timestamptz not null default now(), "updated_at" timestamptz not null default now(), "deleted_at" timestamptz null, constraint "order_pkey" primary key ("uuid"));

create table "product" ("uuid" uuid not null default gen_random_uuid(), "sku" varchar(255) not null, "display_name" varchar(255) not null, "description" varchar(255) null, "price" numeric(10,2) not null default '10.00', "is_on_sale" boolean not null default false, "created_at" timestamptz not null default now(), "updated_at" timestamptz not null default now(), "deleted_at" timestamptz null, constraint "product_pkey" primary key ("uuid"));

create table "order_item" ("uuid" uuid not null default gen_random_uuid(), "order_uuid" uuid not null, "product_uuid" uuid not null, "quantity" int not null, "unit_price" numeric(10,2) null, "created_at" timestamptz not null default now(), constraint "order_item_pkey" primary key ("uuid"));
create index "order_item_order_uuid_index" on "order_item" ("order_uuid");
create index "order_item_product_uuid_index" on "order_item" ("product_uuid");

create table "stock_transaction" ("uuid" uuid not null default gen_random_uuid(), "product_uuid" uuid not null, "quantity" int not null, "type" text check ("type" in ('INCOMING', 'OUTGOING_ORDER', 'ADJUSTMENT')) not null, "reference_id" uuid null, "notes" varchar(255) null, "created_at" timestamptz not null default now(), constraint "stock_transaction_pkey" primary key ("uuid"));
create index "stock_transaction_product_uuid_index" on "stock_transaction" ("product_uuid");

create table "user" ("uuid" uuid not null default gen_random_uuid(), "email" varchar(255) not null, "password_hash" varchar(255) not null, "created_at" timestamptz not null, "updated_at" timestamptz not null, constraint "user_pkey" primary key ("uuid"));
alter table "user" add constraint "user_email_unique" unique ("email");

alter table "order_item" add constraint "order_item_order_uuid_foreign" foreign key ("order_uuid") references "order" ("uuid") on update cascade;
alter table "order_item" add constraint "order_item_product_uuid_foreign" foreign key ("product_uuid") references "product" ("uuid") on update cascade;

alter table "stock_transaction" add constraint "stock_transaction_product_uuid_foreign" foreign key ("product_uuid") references "product" ("uuid") on update cascade;
